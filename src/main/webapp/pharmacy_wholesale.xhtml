<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:bil="http://java.sun.com/jsf/composite/bill"
      xmlns:phi="http://java.sun.com/jsf/composite/pharmacy"
      xmlns:pa="http://java.sun.com/jsf/composite/paymentMethod">
    <body>
        <ui:composition template="./resources/template/template.xhtml">
            <ui:define name="content">
                <h:form id="bill" >
                    <p:defaultCommand  target="btnAdd" />  

                    <p:panel rendered="#{!pharmacyWholesaleController.billPreview}"  header="Pharmacy Wholesale Bill" >
                        <p:panelGrid columns="12" >
                            <p:outputLabel value="Customer" ></p:outputLabel>
                            <p:autoComplete value="#{pharmacyWholesaleController.preBill.toInstitution}"
                                            completeMethod="#{institutionController.completeCreditCompany}"
                                            var="cu" itemLabel="#{cu.name}" itemValue="#{cu}" ></p:autoComplete>
                            <p:spacer height="1" width="10"></p:spacer>
                            <h:outputLabel value="Payment" ></h:outputLabel>
                            <p:selectOneMenu   id="cmbPs" value="#{pharmacyWholesaleController.preBill.paymentMethod}">     
                                <f:selectItems value="#{enumController.paymentMethods}"/>
                                <p:ajax process="cmbPs" update="pBillDetails :#{p:component('tblBillItem')} :#{p:component('panelBillTotals')} :#{p:component('txtQty')} :#{p:component('txtRate')}" 
                                        event="change"   />

                            </p:selectOneMenu>
                            <p:commandButton ajax= "false" accesskey="s" value="Settle" 
                                             action="#{pharmacyWholesaleController.settleBillWithPay}" 
                                             update=" :#{p:component('panelErrorMessage')} :#{p:component('tblBillItem')} :#{p:component('txtRate')} :#{p:component('txtQty')} :#{p:component('acStock')}"  process="cmbPs" actionListener="#{pharmacyWholesaleController.calculateAllRates}">
                                <f:facet name="title" >
                                    <h:outputLabel value="S" style="text-decoration: underline;" ></h:outputLabel>
                                    <h:outputLabel value="ettle"  ></h:outputLabel>
                                </f:facet>
                            </p:commandButton>

                            <p:commandButton accesskey="n" value="New Bill"  ajax="false" action="#{pharmacyWholesaleController.newSaleBill}"  ></p:commandButton>
                            <h:panelGrid id="pBillDetails"  >

                                <h:panelGroup id="creditCardBill" style="display: #{pharmacyWholesaleController.preBill.paymentMethod ne 'Card' ? 'none' : 'block'} ; ">
                                    <pa:creditCard paymentMethodData="#{pharmacyWholesaleController.paymentMethodData}"/>
                                </h:panelGroup>

                                <h:panelGroup id="chequeBill" style="display: #{pharmacyWholesaleController.preBill.paymentMethod ne 'Cheque' ? 'none' : 'block'} ; " >
                                    <pa:cheque paymentMethodData="#{pharmacyWholesaleController.paymentMethodData}"/>
                                </h:panelGroup>

                                <h:panelGroup id="slipBill" style="display: #{pharmacyWholesaleController.preBill.paymentMethod ne 'Slip' ? 'none' : 'block'} ;">
                                    <pa:slip paymentMethodData="#{pharmacyWholesaleController.paymentMethodData}"/>
                                </h:panelGroup>

                            </h:panelGrid>
                        </p:panelGrid>




                        <table  >

                            <tr>
                                <td>
                                    <h:panelGroup rendered="#{pharmacyWholesaleController.errorMessage ne null}" id="panelErrorMessage" >
                                        <p:outputLabel value="#{pharmacyWholesaleController.errorMessage}" style="color: red; padding: 2px; margin: 2px; border: 1px solid red;" ></p:outputLabel>
                                    </h:panelGroup>
                                </td>
                            </tr>

                            <tr style="vertical-align: top;">
                                <td>
                                    <table  >
                                        <tr style="vertical-align: top;">
                                            <td>
                                                <table >
                                                    <tr style="vertical-align: top;">
                                                        <td>

                                                            <p:panel header="Bill Items" >
                                                                <table style="min-width: 300px;">
                                                                    <tr style="vertical-align: top;">
                                                                        <td>
                                                                            <table style="width: 99%;" >
                                                                                <tr style="vertical-align: top;">
                                                                                    <td colspan="4"  style="margin: auto; font-weight: bolder;">
                                                                                        <p:outputLabel value="Medicines/Devices" ></p:outputLabel>
                                                                                    </td>
                                                                                    <td style="min-width: 50px;font-weight: bolder;">
                                                                                        <p:outputLabel for="txtQty" value="Quentity" style="padding: 5px;margin: auto; min-width: 75px; text-align: right; font-weight: bolder;"></p:outputLabel>
                                                                                    </td>
                                                                                    <td style="min-width: 50px;font-weight: bolder;">
                                                                                        <p:outputLabel for="txtFreeQty" value="Free" style="padding: 5px;margin: auto; min-width: 75px; text-align: right; font-weight: bolder;"></p:outputLabel>
                                                                                    </td>

                                                                                    <td style="padding: 2px;margin: auto; min-width: 50px; text-align: right; font-weight: bolder;">
                                                                                        <p:outputLabel value="Rate" ></p:outputLabel>
                                                                                    </td>
                                                                                    <td  style="padding: 2px;margin: auto; min-width: 50px; text-align: right; font-weight: bolder;">
                                                                                        <p:outputLabel value="Value" ></p:outputLabel>
                                                                                    </td>
                                                                                    <td>
                                                                                        <p:focus id="focusQty" for="txtQty" ></p:focus>
                                                                                        <p:focus id="focusItem" for="acStock" ></p:focus>
                                                                                    </td>
                                                                                </tr>

                                                                                <tr style="vertical-align: top;">
                                                                                    <td colspan="4"  style="margin: auto; ">

                                                                                        <style>
                                                                                            .ui-autocomplete-input {width:350px!important;display: block;}
                                                                                            .ui-autocomplete{display: block!important;}
                                                                                        </style>
                                                                                        <p:autoComplete accesskey="i"    id="acStock" 
                                                                                                        value="#{pharmacyWholesaleController.stock}" 
                                                                                                        converter="stockCon" 
                                                                                                        completeMethod="#{pharmacyWholesaleController.completeAvailableStocksFromNameOrGeneric}" 
                                                                                                        var="i" itemLabel="#{i.itemBatch.item.name}" itemValue="#{i}" 
                                                                                                        >
                                                                                            <p:column headerText="Item">
                                                                                                <h:outputLabel value="#{i.itemBatch.item.name}"  style="width: 300px!important;"></h:outputLabel>
                                                                                            </p:column>
                                                                                            <p:column headerText="Code">
                                                                                                <h:outputLabel value="#{i.itemBatch.item.code}" style="width: 50px!important;"></h:outputLabel>
                                                                                            </p:column>
                                                                                            <p:column headerText="Generic">
                                                                                                <h:outputLabel value="#{i.itemBatch.item.vmp.name}" style="width: 150px!important;"></h:outputLabel>
                                                                                            </p:column>
                                                                                            <p:column headerText="Retail Rate">
                                                                                                <h:outputLabel value="#{i.itemBatch.retailsaleRate}"  style="width: 50px!important;">
                                                                                                    <f:convertNumber pattern="#,##0.00" ></f:convertNumber>
                                                                                                </h:outputLabel>
                                                                                            </p:column>
                                                                                            <p:column headerText="Wholesale Margin">
                                                                                                <h:outputLabel value="#{i.itemBatch.wholeSaleMargin}"  style="width: 50px!important;">
                                                                                                </h:outputLabel>
                                                                                            </p:column>
                                                                                            <p:column headerText="Wholesale Rate">
                                                                                                <h:outputLabel value="#{i.itemBatch.wholesaleRate}"  style="width: 50px!important;">
                                                                                                    <f:convertNumber pattern="#,##0.00" ></f:convertNumber>
                                                                                                </h:outputLabel>
                                                                                            </p:column>
                                                                                            <p:column headerText="Free For">
                                                                                                <h:outputLabel value="#{i.itemBatch.wholesaleFreeFor}"  style="width: 50px!important;">
                                                                                                </h:outputLabel>
                                                                                            </p:column>
                                                                                            <p:column headerText="Free Qty">
                                                                                                <h:outputLabel value="#{i.itemBatch.wholesaleFreeQty}"  style="width: 50px!important;">
                                                                                                </h:outputLabel>
                                                                                            </p:column>

                                                                                            <p:column headerText="Stocks">
                                                                                                <h:outputLabel value="#{i.stock}"  style="width: 50px!important;">
                                                                                                    <f:convertNumber pattern="#,###" ></f:convertNumber>
                                                                                                </h:outputLabel>
                                                                                            </p:column>
                                                                                            <p:column headerText="Expiary">
                                                                                                <h:outputLabel value="#{i.itemBatch.dateOfExpire}"  
                                                                                                               style="width: 100px!important;#{commonController.currentDateTime > i.itemBatch.dateOfExpire ?'color: red; background-color: yellow;':''}">
                                                                                                    <f:convertDateTime pattern="dd/MM/yyyy" ></f:convertDateTime>
                                                                                                </h:outputLabel>
                                                                                            </p:column>
                                                                                            <p:ajax event="focus" process="acStock :#{p:component('cmbPs')}"  ></p:ajax>
                                                                                            <p:ajax event="itemSelect"   listener="#{pharmacyWholesaleController.handleSelect}"  update="txtQty txtFreeQty txtRate focusQty :#{p:component('lstReplaceableBatch')}" ></p:ajax>
                                                                                            <p:ajax event="query" update=":#{p:component('tabI')}" process="acStock"></p:ajax>
                                                                                        </p:autoComplete>
                                                                                    </td>
                                                                                    <td style="min-width: 50px;">
                                                                                        <p:inputText  accesskey="q"  autocomplete="off" id="txtQty" value="#{pharmacyWholesaleController.qty}" style="width: 50px!important;"   >
                                                                                            <p:ajax event="keyup"  listener="#{pharmacyWholesaleController.calculateBillItemListner}" process="acStock txtQty :#{p:component('cmbPs')}" update="txtRate txtVal" ></p:ajax>
                                                                                            <p:ajax event="blur"  listener="#{pharmacyWholesaleController.calculateBillItemListner}" process="acStock txtQty :#{p:component('cmbPs')}" update="txtRate txtVal" ></p:ajax>
                                                                                        </p:inputText>
                                                                                    </td>
                                                                                    <td style="min-width: 50px;">
                                                                                        <p:inputText  accesskey="f"  autocomplete="off" id="txtFreeQty" value="#{pharmacyWholesaleController.freeQty}" style="width: 50px!important;"   >
                                                                                            <p:ajax event="keyup"  listener="#{pharmacyWholesaleController.calculateBillItemListner}" process="acStock txtFreeQty :#{p:component('cmbPs')}" update="txtRate txtVal" ></p:ajax>
                                                                                            <p:ajax event="blur"  listener="#{pharmacyWholesaleController.calculateBillItemListner}" process="acStock txtFreeQty :#{p:component('cmbPs')}" update="txtRate txtVal" ></p:ajax>
                                                                                        </p:inputText>
                                                                                    </td>
                                                                                    <td style="padding: 2px;margin: auto; min-width: 50px; text-align: right; font-weight: bolder;">
                                                                                        <p:inputText id="txtRate" value="#{pharmacyWholesaleController.billItem.netRate}" >
                                                                                            <f:convertNumber pattern="#,##0.00" />
                                                                                            <p:ajax event="keyup"  listener="#{pharmacyWholesaleController.calculateBillItemListner}" process="txtRate acStock txtFreeQty :#{p:component('cmbPs')}" update="txtVal" ></p:ajax>
                                                                                            <p:ajax event="blur"  listener="#{pharmacyWholesaleController.calculateBillItemListner}" process="txtRate acStock txtFreeQty :#{p:component('cmbPs')}" update="txtVal" ></p:ajax>
                                                                                        </p:inputText>
                                                                                    </td>
                                                                                    <td  style="padding: 2px;margin: auto; min-width: 50px; text-align: right; font-weight: bolder;">
                                                                                        <p:outputLabel id="txtVal" value="#{pharmacyWholesaleController.billItem.netValue}" >
                                                                                            <f:convertNumber pattern="#,##0.00" />
                                                                                        </p:outputLabel>
                                                                                    </td>
                                                                                    <td>
                                                                                        <p:commandButton  accesskey="a" id="btnAdd" value="Add" 
                                                                                                          action="#{pharmacyWholesaleController.addBillItem}" 
                                                                                                          process="@this acStock txtQty txtFreeQty txtRate :#{p:component('cmbPs')}" 
                                                                                                          update=" :#{p:component('panelErrorMessage')} :#{p:component('netTotal')} :#{p:component('dis')} :#{p:component('total')} :#{p:component('pBillDetails')} :#{p:component('tblBillItem')} txtRate txtQty acStock focusItem :#{p:component('tabI')}" ></p:commandButton>
                                                                                    </td>



                                                                                </tr>
                                                                            </table>
                                                                        </td>
                                                                    </tr>
                                                                    <tr style="vertical-align: top;">
                                                                        <td>
                                                                            <h:panelGroup id="pBis">
                                                                                <p:dataTable id="tblBillItem" 
                                                                                             value="#{pharmacyWholesaleController.preBill.billItems}"
                                                                                             var="bi" rowIndexVar="s" 
                                                                                             editable="true" sortBy="#{bi.searialNo}" 
                                                                                             emptyMessage="No Bill Items Added Yet !">
                                                                                    <p:ajax event="rowEdit" listener="#{pharmacyWholesaleController.onEdit}" update="@this gros :#{p:component('pBillDetails')} :#{p:component('netTotal')} :#{p:component('dis')} :#{p:component('total')} :#{p:component('pBillDetails')} :#{p:component('tblBillItem')} " />  
                                                                                    <p:ajax event="rowEditCancel" listener="#{pharmacyWholesaleController.onEdit}" update="@this gros :#{p:component('netTotal')} :#{p:component('dis')} :#{p:component('total')} :#{p:component('pBillDetails')} :#{p:component('tblBillItem')} " /> 
                                                                                    <f:facet name="header">
                                                                                        Added Bill Items
                                                                                    </f:facet>

                                                                                    <p:column>
                                                                                        <f:facet name="header" >
                                                                                            <div style="min-width: 200px;" ></div>
                                                                                            <h:outputLabel value="Code" style="min-width: 300px;" ></h:outputLabel>
                                                                                        </f:facet>
                                                                                        <h:outputLabel style="min-width: 150px; text-wrap: avoid;" value="#{bi.pharmaceuticalBillItem.itemBatch.item.code}" ></h:outputLabel>
                                                                                    </p:column>
                                                                                    <p:column>
                                                                                        <f:facet name="header" >
                                                                                            <div style="min-width: 200px;" ></div>
                                                                                            <h:outputLabel value="Item" style="min-width: 300px;" ></h:outputLabel>
                                                                                        </f:facet>
                                                                                        <h:outputLabel style="min-width: 150px; text-wrap: avoid;" value="#{bi.pharmaceuticalBillItem.itemBatch.item.name}" ></h:outputLabel>
                                                                                    </p:column>
                                                                                    <p:column headerText="Qty">
                                                                                        <f:facet name="header" >
                                                                                            <div style="min-width: 50px;" ></div>
                                                                                            <h:outputLabel value="Qty" style="min-width: 300px;" ></h:outputLabel>
                                                                                        </f:facet>
                                                                                        <p:cellEditor>  
                                                                                            <f:facet name="output">  
                                                                                                <h:outputText value="#{bi.qty}" >
                                                                                                    <f:convertNumber integerOnly="true" />
                                                                                                </h:outputText>
                                                                                            </f:facet>  
                                                                                            <f:facet name="input">  
                                                                                                <p:inputText id="ipTblQty" value="#{bi.qty}" style="width:96%"/>  
                                                                                            </f:facet>  
                                                                                        </p:cellEditor> 
                                                                                    </p:column>
                                                                                    <p:column headerText="Price">
                                                                                        <f:facet name="header" >
                                                                                            <div style="min-width: 50px;" ></div>
                                                                                            <h:outputLabel value="Qty" style="min-width: 300px;" ></h:outputLabel>
                                                                                        </f:facet>
                                                                                        <p:cellEditor>  
                                                                                            <f:facet name="output">  
                                                                                                <h:outputText value="#{bi.rate}" >
                                                                                                    <f:convertNumber pattern="#,##0.00" />
                                                                                                </h:outputText>
                                                                                            </f:facet>  
                                                                                            <f:facet name="input">  
                                                                                                <h:outputText value="#{bi.rate}" >
                                                                                                    <f:convertNumber pattern="#,##0.00" />
                                                                                                </h:outputText>
                                                                                            </f:facet>  
                                                                                        </p:cellEditor> 
                                                                                    </p:column>
                                                                                    <p:column headerText="Free">
                                                                                        <f:facet name="header" >
                                                                                            <div style="min-width: 50px;" ></div>
                                                                                            <h:outputLabel value="Free" style="min-width: 300px;" ></h:outputLabel>
                                                                                        </f:facet>
                                                                                        <p:cellEditor>  
                                                                                            <f:facet name="output">  
                                                                                                <h:outputText value="#{bi.pharmaceuticalBillItem.freeQtyInUnit}" >
                                                                                                </h:outputText>
                                                                                            </f:facet>  
                                                                                            <f:facet name="input">  
                                                                                                <p:inputText id="ipTblQtyFree" value="#{bi.pharmaceuticalBillItem.freeQtyInUnit}" style="width:96%"/>  
                                                                                            </f:facet>  
                                                                                        </p:cellEditor> 
                                                                                    </p:column>
                                                                                    <p:column >
                                                                                        <f:facet name="header" >
                                                                                            <div style="min-width: 50px;" ></div>
                                                                                            <h:outputLabel value="Discount" style="min-width: 300px;" ></h:outputLabel>
                                                                                        </f:facet>
                                                                                        <h:outputLabel id="rate" value="#{bi.pharmaceuticalBillItem.wholeSaleMargin}" >
                                                                                            <f:convertNumber pattern="#,##0.00" />
                                                                                        </h:outputLabel>
                                                                                    </p:column>
                                                                                    <p:column headerText="Val">
                                                                                        <f:facet name="header" >
                                                                                            <div style="min-width: 50px;" ></div>
                                                                                            <h:outputLabel value="Value" style="min-width: 300px;" ></h:outputLabel>
                                                                                        </f:facet>
                                                                                        <h:outputLabel value="#{bi.grossValue}" id="gros">
                                                                                            <f:convertNumber pattern="#,##0.00" />
                                                                                        </h:outputLabel>
                                                                                    </p:column>
                                                                                    <p:column headerText="Exp">
                                                                                        <f:facet name="header" >
                                                                                            <div style="min-width: 80px;" ></div>
                                                                                            <h:outputLabel value="Expiary" style="min-width: 300px;" ></h:outputLabel>
                                                                                        </f:facet>
                                                                                        <h:outputLabel value="#{bi.pharmaceuticalBillItem.itemBatch.dateOfExpire}" style="#{commonController.currentDateTime > bi.pharmaceuticalBillItem.itemBatch.dateOfExpire ?'color: red; background-color: yellow;':''}" >
                                                                                            <f:convertDateTime pattern="dd/MMM/yyyy" ></f:convertDateTime>
                                                                                        </h:outputLabel>
                                                                                    </p:column>

                                                                                    <p:column headerText="Edit">
                                                                                        <p:rowEditor ></p:rowEditor>
                                                                                    </p:column>
                                                                                    <p:column headerText="Remove">
                                                                                        <p:commandLink  action="#{pharmacyWholesaleController.removeBillItem(bi)}" ajax="false" >
                                                                                            <p:graphicImage library="image" name="remove.png" style="width:30px;height: 30px;" ></p:graphicImage>
                                                                                        </p:commandLink>
                                                                                    </p:column>
                                                                                </p:dataTable>

                                                                            </h:panelGroup>
                                                                        </td>
                                                                    </tr>
                                                                </table>
                                                            </p:panel>


                                                        </td>
                                                        <td>
                                                            <p:panel id="panelBillTotals" header="Bill Totals" >
                                                                <p:panelGrid columns="2" columnClasses="textCol, numberCol"  >
                                                                    <h:outputLabel value="Total" ></h:outputLabel>
                                                                    <h:outputLabel id="total" value="#{pharmacyWholesaleController.preBill.total}" >
                                                                        <f:convertNumber pattern="#,##0.00" />
                                                                    </h:outputLabel>
                                                                    <h:outputLabel value="Discount" ></h:outputLabel>
                                                                    <h:outputLabel id="dis" value="#{pharmacyWholesaleController.preBill.discount}" >
                                                                        <f:convertNumber pattern="#,##0.00" />
                                                                        <p:ajax process="total dis netTotal paid" update="balance netTotal" event="blur"/>
                                                                    </h:outputLabel>
                                                                    <h:outputLabel value="Net Total" ></h:outputLabel>
                                                                    <h:outputLabel id="netTotal" value="#{pharmacyWholesaleController.preBill.netTotal}" >
                                                                        <f:convertNumber pattern="#,##0.00" />
                                                                    </h:outputLabel>
                                                                    <h:outputLabel  value="Tendered" ></h:outputLabel>
                                                                    <p:inputText accesskey="t" autocomplete="off" id="paid" value="#{pharmacyWholesaleController.cashPaidStr}"
                                                                                 style="width: 100px!important;">
                                                                        <p:ajax process="total dis netTotal paid" update="balance netTotal" event="blur"/>
                                                                    </p:inputText>
                                                                    <h:outputLabel  value="Balance " ></h:outputLabel>
                                                                    <h:outputLabel id="balance" value="#{pharmacyWholesaleController.balance}" >
                                                                        <f:convertNumber pattern="#,##0.00" />
                                                                    </h:outputLabel>
                                                                </p:panelGrid>
                                                            </p:panel>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr style="vertical-align: top;">
                                            <td>
                                                <p:panel header="Availability" id="tabI" >

                                                    <p:panelGrid columns="2" style="width: 100%;vertical-align: top;" styleClass="alignTop">

                                                        <h:panelGroup >
                                                            <h:outputLabel value="These " ></h:outputLabel>
                                                            <b>
                                                                <h:outputLabel value=" available Stocks " ></h:outputLabel>
                                                            </b>

                                                            <h:outputLabel value=" that can be used as " ></h:outputLabel>
                                                            <b>
                                                                <h:outputLabel value=" replacement." ></h:outputLabel>
                                                            </b>




                                                        </h:panelGroup>


                                                        <h:panelGroup >
                                                            <h:outputLabel value="Stocks " escape="false" ></h:outputLabel>
                                                            <b>
                                                                <h:outputLabel value=" NOT " escape="false" ></h:outputLabel>

                                                                <i>
                                                                    <h:outputLabel value=" available " escape="false" ></h:outputLabel>
                                                                </i>
                                                            </b>
                                                            <h:outputLabel value=" for these tiems." escape="false" ></h:outputLabel>

                                                        </h:panelGroup>

                                                        <p:dataTable id="lstReplaceableBatch" 
                                                                     selection="#{pharmacyWholesaleController.replacableStock}"
                                                                     value="#{pharmacyWholesaleController.replaceableStocks}" 
                                                                     var="ri" 
                                                                     selectionMode="single"
                                                                     rowKey="#{ri.id}"
                                                                     emptyMessage="System can not detect suitable replacements.">
                                                            <p:ajax event="rowSelect" process="@this" update=":#{p:component('acStock')}" listener="#{pharmacyWholesaleController.makeStockAsBillItemStock()}" ></p:ajax>
                                                            <p:ajax event="rowUnselect" process="@this" update=":#{p:component('acStock')}" listener="#{pharmacyWholesaleController.makeStockAsBillItemStock()}" ></p:ajax>
                                                            <p:column headerText="Item">
                                                                #{ri.itemBatch.item.name}
                                                            </p:column>
                                                            <p:column headerText="Code">
                                                                #{ri.itemBatch.item.code}
                                                            </p:column>
                                                            <p:column headerText="Rate"  style="text-align: right;">
                                                                <p:outputLabel value="#{ri.itemBatch.retailsaleRate}">
                                                                    <f:convertNumber pattern="#,##0.00" ></f:convertNumber>
                                                                </p:outputLabel>
                                                            </p:column>
                                                            <p:column headerText="Stocks" style="text-align: right;">
                                                                <p:outputLabel value="#{ri.stock}"  style="width: 50px!important;">
                                                                    <f:convertNumber pattern="#,###" ></f:convertNumber>
                                                                </p:outputLabel>
                                                            </p:column>
                                                            <p:column headerText="Expiary">
                                                                <h:panelGroup rendered="#{commonController.currentDateTime > ri.itemBatch.dateOfExpire}" >
                                                                    <p:outputLabel value="#{ri.itemBatch.dateOfExpire}" styleClass="ui-messages-fatal"  >
                                                                        <f:convertDateTime pattern="dd/MM/yy" ></f:convertDateTime>
                                                                    </p:outputLabel>
                                                                </h:panelGroup>
                                                                <h:panelGroup rendered="#{ri.itemBatch.dateOfExpire > commonController.currentDateTime}" >
                                                                    <p:outputLabel value="#{ri.itemBatch.dateOfExpire}" >
                                                                        <f:convertDateTime pattern="dd/MM/yy" ></f:convertDateTime>
                                                                    </p:outputLabel>
                                                                </h:panelGroup>
                                                            </p:column>
                                                        </p:dataTable>

                                                        <p:dataTable id="lstSelectItems" 
                                                                     selection="#{pharmacyWholesaleController.selectedAvailableAmp}"
                                                                     value="#{pharmacyWholesaleController.itemsWithoutStocks}" 
                                                                     var="si" 
                                                                     selectionMode="single"
                                                                     rowKey="#{si.id}"
                                                                     emptyMessage="No items with that name without stocks.">
                                                            <p:ajax event="rowSelect" process="@this" update=":#{p:component('lstReplaceableBatch')}" listener="#{pharmacyWholesaleController.selectReplaceableStocks()}" ></p:ajax>
                                                            <p:ajax event="rowUnselect" process="@this" update=":#{p:component('lstReplaceableBatch')}" listener="#{pharmacyWholesaleController.selectReplaceableStocks()}" ></p:ajax>
                                                            <p:column headerText="Generic">
                                                                #{si.vmp.name}
                                                            </p:column>
                                                            <p:column headerText="Name">
                                                                <span class="ui-messages-info-icon" ></span>
                                                                #{si.name}
                                                            </p:column>

                                                        </p:dataTable>
                                                    </p:panelGrid>
                                                </p:panel>                                                
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </p:panel>

                </h:form>



                <h:form>
                    <p:panel  rendered="#{pharmacyWholesaleController.billPreview}" >
                        <p:commandButton id="nullButton3" value="No Action" action="#" style="display: none;" ></p:commandButton>
                        <p:defaultCommand  target="btnPrint" />  

                        <div class="nonPrintBlock" >
                            <p:commandButton accesskey="p" id="btnPrint" value="Print" ajax="false" action="#{pharmacyWholesaleController.newSaleBill()}" actionListener="#{pharmacyWholesaleController.newSaleBill()}" >
                                <p:printer target="gpBillPreview" ></p:printer>
                            </p:commandButton>
                            <p:commandButton accesskey="n" value="New Pharmacy Bill"  ajax="false" action="#{pharmacyWholesaleController.newSaleBill()}" ></p:commandButton>


                            <p:remoteCommand name="rc" update="@all"  actionListener="#{pharmacyWholesaleController.newSaleBill()}" />

                            <p:commandButton value="Imprimir" type="button" 
                                             icon="ui-icon-print" oncomplete="rc();alert('AA');" ajax="false"
                                             style="display:block;margin-bottom: 20px">
                                <p:printer target="gpBillPreview" />
                            </p:commandButton>

                        </div>
                        <div >
                            <h:panelGroup   id="gpBillPreview"   > 
                                <phi:saleBill bill="#{pharmacyWholesaleController.printBill}"></phi:saleBill>
                            </h:panelGroup>
                        </div>



                    </p:panel>

                </h:form>

            </ui:define>

        </ui:composition>

    </body>
</html>
